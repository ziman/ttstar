-- vim: ft=agda

### Desugared ###

postulate T : Type

postulate A : T

postulate B : T

postulate Op : (x :R: T) -> (y :R: T) -> T

id : (x : T) -> T = (\x : T. x)

const_A : (x : T) -> T = (\x : T. A)

f : (g : (_ : T) -> T) -> (z : T) -> (h : (_ : T) -> T) -> (w : T) -> T = (\g : (_ : T) -> T. (\z : T. (\h : (_ : T) -> T. (\w : T. Op (g z) (h w)))))

main :R: T = f id B const_A B

### Metaified ###

postulate T :1: Type

postulate A :2: T

postulate B :3: T

postulate Op :4: (x :R: T) -> (y :R: T) -> T

id :5: (x :6: T) -> T = (\x :7: T. x)

const_A :8: (x :9: T) -> T = (\x :10: T. A)

f :11: (g :12: (_ :13: T) -> T) -> (z :14: T) -> (h :15: (_ :16: T) -> T) -> (w :17: T) -> T = (\g :18: (_ :19: T) -> T. (\z :20: T. (\h :21: (_ :22: T) -> T. (\w :23: T. Op -25- (g -26- z) -24- (h -27- w)))))

main :R: T = f -31- id -30- B -29- const_A -28- B

### Inferred definitions ###

postulate A :2: T {- constraints apply -}
  [] -> [2,R]

postulate B :3: T {- constraints apply -}
  [] -> [3,R]

postulate Op :4: (x :R: T) -> (y :R: T) -> T {- constraints apply -}
  [] -> [4,R]

postulate T :1: Type {- constraints apply -}
  [] -> [1,R]

postulate Type :E: Type

const_A :8: (x :9: T) -> T = (\x :10: T. A) {- constraints apply -}
  [] -> [2,8,R]
  [9] -> [10]
  [10] -> [9]

f :11: (g :12: (_ :13: T) -> T) -> (z :14: T) -> (h :15: (_ :16: T) -> T) -> (w :17: T) -> T = (\g :18: (_ :19: T) -> T. (\z :20: T. (\h :21: (_ :22: T) -> T. (\w :23: T. Op -25- (g -26- z) -24- (h -27- w))))) {- constraints apply -}
  [] -> [4,11,12,15,18,21,24,25,R]
  [13] -> [19]
  [14] -> [20]
  [16] -> [22]
  [17] -> [23]
  [19] -> [13,20,26]
  [20] -> [14]
  [22] -> [16,23,27]
  [23] -> [17]
  [26] -> [19]
  [27] -> [22]

id :5: (x :6: T) -> T = (\x :7: T. x) {- constraints apply -}
  [] -> [5,6,7,R]

main :R: T = f -31- id -30- B -29- const_A -28- B {- constraints apply -}
  [] -> [2,3,4,5,6,7,8,11,12,13,14,15,18,19,20,21,24,25,26,29,30,31,R]
  [9] -> [10,16]
  [10] -> [9]
  [16] -> [9,22]
  [17] -> [23,28]
  [22] -> [16,23,27]
  [23] -> [17]
  [27] -> [22]
  [28] -> [17]


### Constraints ###

[] -> [2,3,4,5,6,7,8,11,12,13,14,15,18,19,20,21,24,25,26,29,30,31,R]
[9] -> [10,16]
[10] -> [9]
[16] -> [9,22]
[17] -> [23,28]
[22] -> [16,23,27]
[23] -> [17]
[27] -> [22]
[28] -> [17]

### Solution ###

[2,3,4,5,6,7,8,11,12,13,14,15,18,19,20,21,24,25,26,29,30,31,R]

### Annotated ###

postulate T :E: Type

postulate A :R: T

postulate B :R: T

postulate Op :R: (x :R: T) -> (y :R: T) -> T

id :R: (x :R: T) -> T = (\x :R: T. x)

const_A :R: (x :E: T) -> T = (\x :E: T. A)

f :R: (g :R: (_ :R: T) -> T) -> (z :R: T) -> (h :R: (_ :E: T) -> T) -> (w :E: T) -> T = (\g :R: (_ :R: T) -> T. (\z :R: T. (\h :R: (_ :E: T) -> T. (\w :E: T. Op -R- (g -R- z) -R- (h -E- w)))))

main :R: T = f -R- id -R- B -R- const_A -E- B

### Specialised ###

postulate T :E: Type

postulate A :R: T

postulate B :R: T

postulate Op :R: (x :R: T) -> (y :R: T) -> T

id :R: (x :R: T) -> T = (\x :R: T. x)

const_A :R: (x :E: T) -> T = (\x :E: T. A)

f :R: (g :R: (_ :R: T) -> T) -> (z :R: T) -> (h :R: (_ :E: T) -> T) -> (w :E: T) -> T = (\g :R: (_ :R: T) -> T. (\z :R: T. (\h :R: (_ :E: T) -> T. (\w :E: T. Op -R- (g -R- z) -R- (h -E- w)))))

main :R: T = f -R- id -R- B -R- const_A -E- B

### Final annotation ###

postulate T :E: Type

postulate A :R: T

postulate B :R: T

postulate Op :R: (x :R: T) -> (y :R: T) -> T

id :R: (x :R: T) -> T = (\x :R: T. x)

const_A :R: (x :E: T) -> T = (\x :E: T. A)

f :R: (g :R: (_ :R: T) -> T) -> (z :R: T) -> (h :R: (_ :E: T) -> T) -> (w :E: T) -> T = (\g :R: (_ :R: T) -> T. (\z :R: T. (\h :R: (_ :E: T) -> T. (\w :E: T. Op -R- (g -R- z) -R- (h -E- w)))))

main :R: T = f -R- id -R- B -R- const_A -E- B

### Verification ###

Verification successful.

### Pruned ###

postulate A : T

postulate B : T

postulate Op : (x) -> (y) -> T

id = (\x. x)

const_A = A

f = (\g. (\z. (\h. Op (g z) h)))

main = f id B const_A

### Normal forms ###

unerased:
  Op B A
erased:
  Op B A
