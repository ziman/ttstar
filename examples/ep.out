-- vim: ft=agda

### Desugared ###

T : *

A : T

B : T

Op : (x : -R-  T) -> (y : -R-  T) -> T

id : (_ :: T) -> T
id = \y :: T. y

constA : (_ :: T) -> T
constA = \_ :: T. A

apply : (f :: (_ :: T) -> T) -> (_ :: T) -> T
apply = \f :: (_ :: T) -> T. \x :: T. (f  x)

test1 : T
test1 = (apply  id  B)

test2 : T
test2 = (apply  constA  B)

main  -R-  T
main = (Op  test1  test2)

### Metaified ###

T :?1: *

A :?2: T

B :?3: T

Op :?4: (x :?5::!R: T) -> (y :?6::!R: T) -> T

id :?7: (_ :?9::?8: T) -> T
id = \y :?11::?10: T. y

constA :?12: (_ :?14::?13: T) -> T
constA = \_ :?16::?15: T. A

apply :?17: (f :?21::?18: (_ :?20::?19: T) -> T) -> (_ :?23::?22: T) -> T
apply = \f :?27::?24: (_ :?26::?25: T) -> T. \x :?29::?28: T. (f -?30-  -?31- x)

test1 :?32: T
test1 = (apply -?35-  -?36- id -?33-  -?34- B)

test2 :?37: T
test2 = (apply -?40-  -?41- constA -?38-  -?39- B)

main :!R: T
main = (Op -?44-  -?45- test1 -?42-  -?43- test2)

### Inferred definitions ###

A :?2: T
B :?3: T
Op :?4: (x :?5::!R: T) -> (y :?6::!R: T) -> T
T :?1: *
apply :?17: (f :?21::?18: (_ :?20::?19: T) -> T) -> (_ :?23::?22: T) -> T
  [] -> [?18,?24,!R]
  [?19] -> [?25]
  [?20] -> [?26]
  [?21] -> [?27]
  [?22] -> [?28]
  [?23] -> [?29]
  [?25] -> [?19,?28,?31]
  [?26] -> [?20,?30]
  [?27] -> [?21]
  [?28] -> [?22]
  [?29] -> [?23]
  [?30] -> [?26]
  [?31] -> [?25]

constA :?12: (_ :?14::?13: T) -> T
  [] -> [?2,!R]
  [?13] -> [?15]
  [?14] -> [?16]
  [?15] -> [?13]
  [?16] -> [?14]

id :?7: (_ :?9::?8: T) -> T
  [] -> [?8,?10,!R]
  [?9] -> [?11]
  [?11] -> [?9]

main :!R: T
  [] -> [?2_6,?3_5,?4,?7_5,?8_5,?9_5,?10_5,?11_5,?12_6,?17_5,?17_6,?18_5,?18_6,?19_5,?20_5,?21_5,?21_6,?22_5,?23_5,?24_5,?24_6,?25_5,?26_5,?27_5,?27_6,?28_5,?29_5,?30_5,?31_5,?32,?33_5,?34_5,?35_5,?36_5,?37,?40_6,?41_6,?43,?45,!R]
  [?5] -> [?44]
  [?6] -> [?42]
  [?13_6] -> [?14_6,?15_6,?19_6]
  [?14_6] -> [?16_6,?20_6]
  [?15_6] -> [?13_6]
  [?16_6] -> [?14_6]
  [?19_6] -> [?13_6,?20_6,?25_6]
  [?20_6] -> [?14_6,?26_6]
  [?22_6] -> [?3_6,?23_6,?28_6,?39_6]
  [?23_6] -> [?29_6,?38_6]
  [?25_6] -> [?19_6,?28_6,?31_6]
  [?26_6] -> [?20_6,?30_6]
  [?28_6] -> [?22_6]
  [?29_6] -> [?23_6]
  [?30_6] -> [?26_6]
  [?31_6] -> [?25_6]
  [?38_6] -> [?23_6]
  [?39_6] -> [?22_6]
  [?42] -> [?6]
  [?44] -> [?5]

test1 :?32: T
  [] -> [?3,?7,?8_2,?9,?10_2,?17,?18_1,?19_1,?20,?21,?22_1,?23,?24_1,?25_1,?28_1,?31_1,?33,?34,?35,?36,!R]
  [?9_2] -> [?11_2,?20_1]
  [?11_2] -> [?9_2]
  [?20_1] -> [?9_2,?26_1]
  [?21_1] -> [?27_1]
  [?23_1] -> [?29_1]
  [?26_1] -> [?20_1,?30_1]
  [?27_1] -> [?21_1]
  [?29_1] -> [?23_1]
  [?30_1] -> [?26_1]

test2 :?37: T
  [] -> [?2_4,?12,?17,?18_3,?21,?24_3,?40,?41,!R]
  [?13_4] -> [?14,?15_4,?19_3]
  [?14_4] -> [?16_4,?20_3]
  [?15_4] -> [?13_4]
  [?16_4] -> [?14_4]
  [?19_3] -> [?13_4,?20,?25_3]
  [?20_3] -> [?14_4,?26_3]
  [?21_3] -> [?27_3]
  [?22_3] -> [?3,?23,?28_3,?39]
  [?23] -> [?38]
  [?23_3] -> [?29_3]
  [?25_3] -> [?19_3,?28_3,?31_3]
  [?26_3] -> [?20_3,?30_3]
  [?27_3] -> [?21_3]
  [?28_3] -> [?22_3]
  [?29_3] -> [?23_3]
  [?30_3] -> [?26_3]
  [?31_3] -> [?25_3]
  [?38] -> [?23]
  [?39] -> [?22_3]


### Constraints ###

[] -> [?2,?2_4,?2_6,?3,?3_5,?4,?7,?7_5,?8,?8_2,?8_5,?9,?9_5,?10,?10_2,?10_5,?11_5,?12,?12_6,?17,?17_5,?17_6,?18,?18_1,?18_3,?18_5,?18_6,?19_1,?19_5,?20,?20_5,?21,?21_5,?21_6,?22_1,?22_5,?23,?23_5,?24,?24_1,?24_3,?24_5,?24_6,?25_1,?25_5,?26_5,?27_5,?27_6,?28_1,?28_5,?29_5,?30_5,?31_1,?31_5,?32,?33,?33_5,?34,?34_5,?35,?35_5,?36,?36_5,?37,?40,?40_6,?41,?41_6,?43,?45,!R]
[?5] -> [?44]
[?6] -> [?42]
[?9] -> [?11]
[?9_2] -> [?11_2,?20_1]
[?11] -> [?9]
[?11_2] -> [?9_2]
[?13] -> [?15]
[?13_4] -> [?14,?15_4,?19_3]
[?13_6] -> [?14_6,?15_6,?19_6]
[?14] -> [?16]
[?14_4] -> [?16_4,?20_3]
[?14_6] -> [?16_6,?20_6]
[?15] -> [?13]
[?15_4] -> [?13_4]
[?15_6] -> [?13_6]
[?16] -> [?14]
[?16_4] -> [?14_4]
[?16_6] -> [?14_6]
[?19] -> [?25]
[?19_3] -> [?13_4,?20,?25_3]
[?19_6] -> [?13_6,?20_6,?25_6]
[?20] -> [?26]
[?20_1] -> [?9_2,?26_1]
[?20_3] -> [?14_4,?26_3]
[?20_6] -> [?14_6,?26_6]
[?21] -> [?27]
[?21_1] -> [?27_1]
[?21_3] -> [?27_3]
[?22] -> [?28]
[?22_3] -> [?3,?23,?28_3,?39]
[?22_6] -> [?3_6,?23_6,?28_6,?39_6]
[?23] -> [?29,?38]
[?23_1] -> [?29_1]
[?23_3] -> [?29_3]
[?23_6] -> [?29_6,?38_6]
[?25] -> [?19,?28,?31]
[?25_3] -> [?19_3,?28_3,?31_3]
[?25_6] -> [?19_6,?28_6,?31_6]
[?26] -> [?20,?30]
[?26_1] -> [?20_1,?30_1]
[?26_3] -> [?20_3,?30_3]
[?26_6] -> [?20_6,?30_6]
[?27] -> [?21]
[?27_1] -> [?21_1]
[?27_3] -> [?21_3]
[?28] -> [?22]
[?28_3] -> [?22_3]
[?28_6] -> [?22_6]
[?29] -> [?23]
[?29_1] -> [?23_1]
[?29_3] -> [?23_3]
[?29_6] -> [?23_6]
[?30] -> [?26]
[?30_1] -> [?26_1]
[?30_3] -> [?26_3]
[?30_6] -> [?26_6]
[?31] -> [?25]
[?31_3] -> [?25_3]
[?31_6] -> [?25_6]
[?38] -> [?23]
[?38_6] -> [?23_6]
[?39] -> [?22_3]
[?39_6] -> [?22_6]
[?42] -> [?6]
[?44] -> [?5]

### Solution ###

[?2,?2_4,?2_6,?3,?3_5,?4,?7,?7_5,?8,?8_2,?8_5,?9,?9_5,?10,?10_2,?10_5,?11,?11_5,?12,?12_6,?17,?17_5,?17_6,?18,?18_1,?18_3,?18_5,?18_6,?19_1,?19_5,?20,?20_5,?21,?21_5,?21_6,?22_1,?22_5,?23,?23_5,?24,?24_1,?24_3,?24_5,?24_6,?25_1,?25_5,?26,?26_5,?27,?27_5,?27_6,?28_1,?28_5,?29,?29_5,?30,?30_5,?31_1,?31_5,?32,?33,?33_5,?34,?34_5,?35,?35_5,?36,?36_5,?37,?38,?40,?40_6,?41,?41_6,?43,?45,!R]

### Annotated ###

T :E: *

A :R: T

B :R: T

Op :R: (x :E::R: T) -> (y :E::R: T) -> T

id :R: (_ :R::R: T) -> T
id = \y :R::R: T. y

constA :R: (_ :E::E: T) -> T
constA = \_ :E::E: T. A

apply :R: (f :R::R: (_ :R::E: T) -> T) -> (_ :R::E: T) -> T
apply = \f :R::R: (_ :R::E: T) -> T. \x :R::E: T. (f -R-  -E- x)

test1 :R: T
test1 = (apply -R-  -R- id -R-  -R- B)

test2 :R: T
test2 = (apply -R-  -R- constA -R-  -E- B)

main :R: T
main = (Op -E-  -R- test1 -E-  -R- test2)

### Pruned ###

id = \y. y

constA = A

apply = \f. \x. (f  ____)

test1 = (apply  id  B)

test2 = (apply  constA  ____)

main = (Op  test1  test2)

### Normal forms ###

unerased:
  (Op  B  A)
erased:
  (Op  ____  (A  ____))
